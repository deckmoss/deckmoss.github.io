<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,maximum-scale=5" name=viewport><meta content=strict-origin-when-cross-origin name=referrer><meta content="default-src 'none'; font-src 'self' data:; img-src 'self'    ; script-src 'self' ; manifest-src 'self'; style-src 'self' 'sha512-yEu3N5dtmkZZvTpHwas9Yh7Pr4nIjoqNRpqjBSoxgXABioSmm8UOQJDmPRU/4Pj+N0XZcPnFXjbDmWxfyq/FNw==' 'sha512-sKMPvRXUp+YB1ax6LVwVIhc9uSglfPg7BUm6EdAC+1dXVMEa5OvqIHnHLCiFJGTi78TOI0q6AHTpZEYW3h/3ig==' ; media-src 'self'; frame-src 'self' https://player.vimeo.com/ https://www.youtube.com/ https://www.youtube-nocookie.com/ ; object-src 'none'; base-uri 'self'; form-action 'self'; connect-src 'self' " http-equiv=Content-Security-Policy><meta content=index,follow name=robots><meta content=#2C2D32 name=theme-color><link href=/manifest.json rel=manifest><title>How to unchain inodes on NixOS, while getting rid of orphaned packages [Introduction] • Portfolio</title><meta content="Prismatic Arbiter" name=author><meta content="Employ your garbage collector sustainably on NixOS." name=description><meta content=Linux,NixOS,configuration.nix,Migration name=keywords><link title="Portfolio Atom Feed" href=https://deckmoss.github.io/atom.xml rel=alternate type=application/atom+xml><meta content=en_US property=og:locale><meta content=article property=og:type><meta content="How to unchain inodes on NixOS, while getting rid of orphaned packages [Introduction]" property=og:title><meta content="Employ your garbage collector sustainably on NixOS." property=og:description><meta content=https://deckmoss.github.io/posts/degarbage_nixos/ property=og:url><meta content=Portfolio property=og:site_name><link href=https://deckmoss.github.io/posts/degarbage_nixos/ rel=canonical><meta content=/posts/degarbage_nixos/urban.gif property=og:image><meta content=/posts/degarbage_nixos/urban.gif name=twitter:card><meta content=/posts/degarbage_nixos/urban.gif name=twitter:image><meta content="How to unchain inodes on NixOS, while getting rid of orphaned packages [Introduction]" name=twitter:title><meta content="Employ your garbage collector sustainably on NixOS." name=twitter:description><meta content=320 name=MobileOptimized><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content="width=device-width,initial-scale=1.0,maximum-scale=5" name=viewport><link href=/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href="/favicon-32x32.png?v=5e23bffe691055b88067cbc8d11b96ce2a8dc5e25e49367803766a3cadbcfc7f05a62079bfa558d5e234c6a7455d21fc2960b196bda5cbd591bd4c2dbe67920d" rel=icon sizes=32x32 type=image/png><link href="/favicon-16x16.png?v=7267c6f502a03c1e4df9d8136dcc6cd9e67e0b9644941d22ed34e4fe747580f95a65f77a183bb967c1ec60eecd0c298b2670d89a67a647391fb7d1501bcf0982" rel=icon sizes=16x16 type=image/png><link href="/unstyle.css?v=b14bd48a2efbd463d973763aa3184c69aa02164c0891acacc9eab49ddd275f98f0050b4c31d2093e4671e7abe04f9459a041f0064384a90d97b8ff21b6824825" rel=stylesheet><link href="/main.css?v=0ef3a7ff94b3ed8bea2b49c10951990e0551c7010f21a53f38b220b8fe1f742bc119555a5389f8dcff2f82def067e074fa602f8f81d1dfed5e4cc484b63ea73b" rel=stylesheet><link href="/langs.css?v=12474958ee314a9fde4704e1f5a032dc632d41f9461faca326ac284297766c4ceb07b45fec7fbc09fa72b0f21dcc64f0c31e64fc2e5e838b1d30f5fe540afd78" rel=stylesheet><link href="/syntax-theme-light.css?v=cd0c50d55d1963aecfc6f7e98bd1f1add862f0acf7dcc54e3df250d25b2a00cc889155817be05ede71357dbdea9aa7ffd9bfba216da84fea092119d58a460936" media="(prefers-color-scheme: light)" rel=stylesheet><link href="/syntax-theme-dark.css?v=dfede4879841e4a58e5fc71115aa5f5b82e206d85eb771ff4e5a40a1d82621570aad2458f637365ae4370d9a1cf5070edc9765f7c2d4506e12e2ba3c6081ffd5" media="(prefers-color-scheme: dark)" rel=stylesheet><link href="/sw-style.css?v=a0fa1e87fa2bb3e03d18cefc81ef5c8cfa58c6aa6eea0af223fa155e088bc5af22d32d3ee785ebd3fc26b4c49b70f0bd423f7d592a419a24e6d1e2cb720b7e05" rel=stylesheet><style>#posts.inner-post-page .block-left{background:linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)),url("/posts/degarbage_nixos/urban.gif?v=8739ae0f6bd312a256096887df821ac340473f1e7f82bf7dad03f42e7482df11d999510c0d5f914e1d7803ee98ab1243141857e2c9664e0eb33cffc4dce89788") no-repeat;background-size:cover}</style><style>#posts .block-left{background:linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)),url("/bk-prk.png?v=b00246fb5faeab35a588f347224b00d53083a9d5f4ae8cd87c0c2e0432bf7f348c6a6ab6f4e4edaf5ddbf13ee34b24946dd0af4cd7db6f4f334599f38917ac9e") no-repeat;background-size:cover,cover}.block-left{background:linear-gradient(rgba(44,45,51,0.9),rgba(44,45,51,0.9)),url("/c1tyh4ll.png?v=e6bb8cdead47e48c0deba1e0a3016070984b5f7271166a72638f9ec5a6ef2d2eb8012e8e4cb64f4f3b6574c6d708bf2ae660d04b8b59a6de675ce4d4d62dd4c3") no-repeat;background-size:cover}</style><body class=inner-post-page id=posts><div class=block-left><div class=content><a class=logo href=/><img src="/icon-192x192.png?v=3820c1b1e6d755d2b7c2a04a65f0f1feef793b297f7ee995947137ccd8f73ec304457f6ce1df987a9a0a13ed7dacd203225505b832ccd2318b530ae53a55cebc" alt=logo height=64 width=64></a><div class=post-title-section><h1 class=section-title>How to unchain inodes on NixOS, while getting rid of orphaned packages [Introduction]</h1><ul class=tags><li><a href=/tags/linux/>Linux</a><li><a href=/tags/nixos/>NixOS</a><li><a href=/tags/configuration-nix/>configuration.nix</a><li><a href=/tags/migration/>Migration</a></ul></div></div></div><div class=block-right><div id=nav-container><nav class=nav-bar role=navigation><ul class=nav-menu><li><a href=/>Home</a><li class=nav-active><a aria-haspopup=true href=/posts/>Posts</a> <ul aria-label=submenu class=dropdown><li><a href=/posts/>Index</a><li><a href=/tags/>Tags</a><li><a href=/categories/>Categories</a></ul><li><a href=/projects/>Code</a></ul></nav><script src="/elasticlunr.min.js?v=b9be63b71422cbfde9f14310b397d9a7092f2946bffec11811a831398ace978c1c592e9a578f1fa32041e6c0dde68657fe58d3c30b0eaa758c63c5fd45117336" defer></script><script integrity="sha512-ub6iGfrBOBOxmpNdlB/4CwGdlYCXb2birPYg8xhNSZ6Jy+EuIWAkxBvKca9BXALNOGorKsuz+aG/4c0UAu20Zw==" , defer src=/search.js></script><nav class=search-container id=search-nav><input aria-label=Search id=search placeholder=Search type=search><div class=search-results><div class=search-results__items></div></div></nav></div><div class="inner-post content"><div class=date-highlight>12 Jul 2025</div><h1>Employ your garbage collector sustainably on NixOS.</h1><div class=post-info><div class=post-ext-info><p>2 minutes reading time<p>Updated 15 Jul 2025</div></div><div class=toc-block><ul><li><a class="toc-anchor toc" href="https://deckmoss.github.io/posts/degarbage_nixos/#In_case_you're_like_me_new_to_NixOS...">In case you're like me new to NixOS...</a><li><a class="toc-anchor toc" href=https://deckmoss.github.io/posts/degarbage_nixos/#Continue_with>Continue with</a></ul></div><h2 id="In_case_you're_like_me_new_to_NixOS..."><a aria-label="Anchor link for: In_case_you're_like_me_new_to_NixOS..." href="#In_case_you're_like_me_new_to_NixOS..." class=zola-anchor>#</a>In case you're like me new to NixOS...</h2><p class=notice_info><strong><em>...you may not have noticed that it is obligatory to declare certain lines for automatic garbage collection in your configuration.nix. Otherwise, you might end up in the worst-case scenario with not a single free <abbr title="Inodes are essential on Unix-like systems (such as Linux-based OS) for storing metadata of files. They may get consumed long before the memory capacity of their volume is exceeded.">inode</abbr> left to link.<br><br> I use <abbr title="modern file system format">btrfs</abbr> and had already completed <abbr title="BUILDS are called GENERATIONS in nix">120 builds</abbr> when my system crashed during the 121st build process, displaying an error like "no space left on device," even though I had a few hundred unused gigabytes available.<br><br> It turned out that hundreds of thousands of files and system links had been created over time, which consumed all of my inodes. I assume that old links were not deallocated and that nixos preserved a totally useless software package release history on my disk. At that point, it became <abbr title="Because every new build consumes new inodes without freeing old ones">impossible to rebuild nixos.</abbr></em></strong><p class=notice_danger><strong> ❌ Result: You can't simply <abbr title="to comment smth out causes nixos to build a new system profile, old packages persist as orphanes">comment out something in the configuration.nix</abbr> nor initiate garbage collection rules there, because it's too late. You can't fix this via the configuration.nix file at all.</strong><h2 id=Continue_with><a aria-label="Anchor link for: Continue_with" class=zola-anchor href=#Continue_with>#</a>Continue with</h2><p><a border="5px solid black" class="btn btn_info" href=/posts/checking_inodes>[ 1. checking partition stats ] </a><p><a class="btn btn_success" href=/posts/nixos-garbage-collector>[ 2. running garbage-collector ]</a></p><br><nav class=pagination><a class=pagination_pager href=/posts/unleash_ram/>prev</a><a class=pagination_pager href=/posts/checking_inodes/>next</a></nav></div><section class=footer-content><footer id=footer-block><nav class=nav-footer role=navigation><ul aria-label="footer links" class=footer-links><li><a href=/>index</a><li><a href=/sitemap.xml>sitemap</a><li><a href=/posts/>posts</a></ul></nav><p>b6436da <b>©</b> 2025 Prismatic Arbiter<p>Powered by <a href=https://www.getzola.org target=_blank>Zola</a> & <a href=https://halve-z.netlify.app target=_blank>Halve-Z</a></footer></section></div><div class=toastBox></div><span id=precache-payload>/sw-load.js?v=e5ae5a1ed170f4499ac6292e7164b68528c51f6d6518cd75a49e6a6b737831d5728da21fc14dcbc7a91328e53858c6ff7195cc3fc8b25f0feeaef2af151d6686 /fireball.gif?v=569e393374f2af74d6c575090904aaf51e641e5eb5ea89ae7c7de01f7293abc165b3a7e8685690a8b951c778603fec98ae6822ff2f7ea86a536776966cb65d5d /favicon.ico?v=1a6495bbd14c74c75aa77e28420ce82a63372b28cd38c952b98403d8d112a9f76589bea299982ca27048215e661245f9d07294bddee7da377aaee76eee70c622 /favicon-16x16.png?v=7267c6f502a03c1e4df9d8136dcc6cd9e67e0b9644941d22ed34e4fe747580f95a65f77a183bb967c1ec60eecd0c298b2670d89a67a647391fb7d1501bcf0982 /favicon-32x32.png?v=5e23bffe691055b88067cbc8d11b96ce2a8dc5e25e49367803766a3cadbcfc7f05a62079bfa558d5e234c6a7455d21fc2960b196bda5cbd591bd4c2dbe67920d /icon-192x192.png?v=3820c1b1e6d755d2b7c2a04a65f0f1feef793b297f7ee995947137ccd8f73ec304457f6ce1df987a9a0a13ed7dacd203225505b832ccd2318b530ae53a55cebc /icon-512x512.png?v=de62ae905479fd813300d286ed1d2fe6bb6f6292623a5d918691642f6dd09a68943c69ed2a95a1820076919e69ff4fda668bb79e610ebc1d3200fedd7f634443 /apple-touch-icon.png?v=4718a090c66653794b3622234784e821a504ee526b6518f20cd10f6b27907566690892339830ede2ef9cb5fedb8a9796f02fb2610de868500c0720c1083013b7 /main.css?v=0ef3a7ff94b3ed8bea2b49c10951990e0551c7010f21a53f38b220b8fe1f742bc119555a5389f8dcff2f82def067e074fa602f8f81d1dfed5e4cc484b63ea73b /nerd-fonts.css?v=4b2ec75c55a664da78189dc20d4017cf5bc817cf3b60218a2446ba269ca4fd42c117352d5276363965f35fae32891efce751e0626b5281bae627f40d804a5679 /unstyle.css?v=b14bd48a2efbd463d973763aa3184c69aa02164c0891acacc9eab49ddd275f98f0050b4c31d2093e4671e7abe04f9459a041f0064384a90d97b8ff21b6824825 /langs.css?v=12474958ee314a9fde4704e1f5a032dc632d41f9461faca326ac284297766c4ceb07b45fec7fbc09fa72b0f21dcc64f0c31e64fc2e5e838b1d30f5fe540afd78 /syntax-theme-light.css?v=cd0c50d55d1963aecfc6f7e98bd1f1add862f0acf7dcc54e3df250d25b2a00cc889155817be05ede71357dbdea9aa7ffd9bfba216da84fea092119d58a460936 /syntax-theme-dark.css?v=dfede4879841e4a58e5fc71115aa5f5b82e206d85eb771ff4e5a40a1d82621570aad2458f637365ae4370d9a1cf5070edc9765f7c2d4506e12e2ba3c6081ffd5 /sw-style.css?v=a0fa1e87fa2bb3e03d18cefc81ef5c8cfa58c6aa6eea0af223fa155e088bc5af22d32d3ee785ebd3fc26b4c49b70f0bd423f7d592a419a24e6d1e2cb720b7e05 /categories/ /categories/NixOS/ /categories/hardware/ /tags/ /tags/DIY/ /tags/Linux/ /tags/Migration/ /tags/NixOS/ /tags/Partition Types/ /tags/configuration.nix/ /tags/hacks/ /tags/linux/ /tags/notebooks/ /posts/nixos-garbage-collector/ /posts/nixos-garbage-collector/urban.gif?v=8739ae0f6bd312a256096887df821ac340473f1e7f82bf7dad03f42e7482df11d999510c0d5f914e1d7803ee98ab1243141857e2c9664e0eb33cffc4dce89788 /posts/checking_inodes/ /posts/checking_inodes/urban.gif?v=8739ae0f6bd312a256096887df821ac340473f1e7f82bf7dad03f42e7482df11d999510c0d5f914e1d7803ee98ab1243141857e2c9664e0eb33cffc4dce89788 /posts/degarbage_nixos/ /posts/degarbage_nixos/urban.gif?v=8739ae0f6bd312a256096887df821ac340473f1e7f82bf7dad03f42e7482df11d999510c0d5f914e1d7803ee98ab1243141857e2c9664e0eb33cffc4dce89788 /posts/unleash_ram/ /posts/unleash_ram/urban.gif?v=8739ae0f6bd312a256096887df821ac340473f1e7f82bf7dad03f42e7482df11d999510c0d5f914e1d7803ee98ab1243141857e2c9664e0eb33cffc4dce89788 /posts/unleash_ram/vendor.png?v=198e6e02ed33103c0f6866c5b39c1e75cfa05c7db1f7813ba26a027ab2fd29608d324873462c53a6255f86d6968e7e435873fe36ddaf5ed2df2bd5a636999ef1 /projects/ /posts/ c1tyh4ll.png?v=e6bb8cdead47e48c0deba1e0a3016070984b5f7271166a72638f9ec5a6ef2d2eb8012e8e4cb64f4f3b6574c6d708bf2ae660d04b8b59a6de675ce4d4d62dd4c3 bk-prk.png?v=b00246fb5faeab35a588f347224b00d53083a9d5f4ae8cd87c0c2e0432bf7f348c6a6ab6f4e4edaf5ddbf13ee34b24946dd0af4cd7db6f4f334599f38917ac9e bk-prk.png?v=b00246fb5faeab35a588f347224b00d53083a9d5f4ae8cd87c0c2e0432bf7f348c6a6ab6f4e4edaf5ddbf13ee34b24946dd0af4cd7db6f4f334599f38917ac9e /icon-192x192.png?v=3820c1b1e6d755d2b7c2a04a65f0f1feef793b297f7ee995947137ccd8f73ec304457f6ce1df987a9a0a13ed7dacd203225505b832ccd2318b530ae53a55cebc /glitch.css?v=0b9b7f8691385df5b832251e9cf4c56d68cbcfc98c6e4c27e015f6fb29d2f0c18c358c98c0e7e0a1da9f263d6b355b811e49aac099b70889090912a5040f754a /sitemap.xml /search_index.en.json /search.js /elasticlunr.min.js?v=b9be63b71422cbfde9f14310b397d9a7092f2946bffec11811a831398ace978c1c592e9a578f1fa32041e6c0dde68657fe58d3c30b0eaa758c63c5fd45117336"></span><script integrity="sha512-5a5aHtFw9EmaxikucWS2hSjFH21lGM11pJ5qa3N4MdVyjaIfwU3Lx6kTKOU4WMb/cZXMP8iyXw/urvKvFR1mhg==" src="/sw-load.js?v=e5ae5a1ed170f4499ac6292e7164b68528c51f6d6518cd75a49e6a6b737831d5728da21fc14dcbc7a91328e53858c6ff7195cc3fc8b25f0feeaef2af151d6686" type=module></script>